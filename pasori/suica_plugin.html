<!DOCTYPE html>
<html lang="ja">
<head>
<title>suica_plugin</title>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<link rel="stylesheet" title="black" href="../black.css" type="text/css">
<link rel="stylesheet" title="white" href="../white.css" type="text/css">
</head>
<body>

<h1>suica_plugin</h1>
<h2>概要</h2>
<ul>
 <li> PaSoRi (MODEL RC-S320) を使って Suica の履歴を<a
      href="../graif/">graif</a>に保存するための graif プラグインです
      (2008/12/27 更新) 。
 <li> PASMO や ICOCA の履歴も (多分) 表示、保存できます。
 <li> 動作には <a href="http://ruby-gnome2.sourceforge.jp/ja/">Ruby-GNOME2</a>,
      <A href="http://www.ruby-lang.org/ja/">Ruby</a>, <a href="libpafe.html">libpafe</a>,
      <a href="libpafe-ruby.html">libpafe-ruby</a>, <a href="../graif/">graif</a> が必要です。
</ul>

<h2>動作環境</h2>
<ul>
 <li> PaSoRi MODEL RC-S320
 <li> graif (version 1.0.2 で動作確認)
</ul>

<h2>ダウンロード</h2>
<p><a href="suica_plugin.rb">suica_plugin.rb</a></p>
<p>ダウンロードしたファイルは「~/.graif/plugins/」にコピーしてください。

<h2>スクリーンショット</h2>
<p><a href="suica_plugin.png"><img src="suica_plugin_s.png" width="542" height="408"></a></p>

<h2>使い方</h2>

<ul>
 <li> graif の |ファイル(F)|プラグイン(P)|Suica| から起動して「更新」ボタ
      ンを押すと履歴が読み込まれ、表示されます。
 <li> 「分類」や「アカウント」はカードごとにデフォルトの値を保存しますの
      で、初めて使うカードの場合は一度「更新」でデータを読み込んでから
      「設定」で各種の設定を行い、再度「更新」でデータを読み直してくださ
      い。
 <li> 今のところ「設定」の「詳細を表示する」は機能しません。
 <li> 後述の駅名データを保存してあれば駅名なども表示されます。
 <li> 未登録のデータは |編集(E)|編集(E)...|で登録できます。
 <li> 「保存」ボタンを押すと、「保存」カラムにチェックされている履歴が保
      存されます。もっとも古い履歴の「保存」カラムにチェックされていると
      その残高が「調整」として保存されます。
 <li> 「更新」ボタンを押したときは前回保存されたデータよりも新しい履歴の
      「保存」カラムがあらかじめチェックされています。
 <li> 「分類」、「時刻」、「口座」の各カラムは直接編集できます。
</ul>

<h2>駅名データベース</h2>
<p>
<a href="http://www014.upp.so-net.ne.jp/SFCardFan/">IC SFCard Fan</a>で配
布されている「店舗・駅コード情報データベース」を利用することで、駅名など
の表示ができます。下記手順にしたがってデータベースを保存してください。
</p>

<ol>
 <li> <a href="http://www014.upp.so-net.ne.jp/SFCardFan/">IC SFCard
      Fan</a>の「サイバネ駅コード調査データベース」から「Excel 形式で保存
      (汎用)」でExcel ファイルを入手します。
 <li> 上記ファイルを StationCode0.csv, StationCode1.csv, StationCode2.csv,
      StationCode3.csv として文字コードを UTF-8 にして
      CSV形式で保存します。<br>
      <a href="http://chicago.sourceforge.net/xlhtml/">xlhtml</a>
      を使うと下記のコマンドで CSV 形式に変換できます。
      <pre>
       xlhtml -csv -xp:0 -m ~/StationCode.xls > StationCode0.csv
       xlhtml -csv -xp:1 -m ~/StationCode.xls > StationCode1.csv
       xlhtml -csv -xp:2 -m ~/StationCode.xls > StationCode2.csv
       xlhtml -csv -xp:3 -m ~/StationCode.xls > StationCode3.csv
      </pre>
 <li> データを ~/.gsuica/station_code/ に保存します。
 <li> CSV への変換、文字コードの変換、所定のディレクトリへのデータの保存
      を行うスクリプトを作りました。<br>
      <a href="station_code_conv.sh">station_code_conv.sh</a>
      <pre>
      sh station_code_conv.sh StationCode.xls
      </pre>
      と実行します。

</ol>

<h2>注意</h2>
<ul>
 <li> 駅名などが正常に表示されない場合、プログラム側に問題がある可能性が
      大きいと思われます。このプログラムを使用した結果についての問い合わ
      せは IC SFCard Fan ではなく下記連絡先にお願いします。
 <li> このプログラムは完全に無保証です。
</ul>

<h2>謝辞</h2>
<ul>
 <li> プログラムの作成にあたり、<a
      href="http://www014.upp.so-net.ne.jp/SFCardFan/">IC SFCard Fan</a>、
      <a href="http://sourceforge.jp/projects/felicalib">FeliCa Library</a>
      および<a href="http://wiki.osdev.info/?PaSoRi%2FRC-S320">PaSoRi/RC-S320 - osdev-j (MMA)</a>
      で得られる情報を参考にさせていただきました。
 <li> <a href="http://www014.upp.so-net.ne.jp/SFCardFan/">IC SFCard Fan</a>
      のデータベースを利用することで、駅名などの表示が可能になりました。
</ul>

<h2>Link</h2>
<ul>
 <li> <a href="http://wiki.osdev.info/?PaSoRi%2FRC-S320">PaSoRi/RC-S320 - osdev-j (MMA)</a>
 <li> <a href="http://www014.upp.so-net.ne.jp/SFCardFan/">IC SFCard Fan</a>
 <li> <a href="http://sourceforge.jp/projects/felicalib">FeliCa Library</a>
 <li> <a href="http://chicago.sourceforge.net/xlhtml/">xlhtml</a>
 <li> <a href="http://ruby-gnome2.sourceforge.jp/ja/">Ruby-GNOME2</a>
 <li> <a href="http://www.gnome.org">GNOME</a>
 <li> <A href="http://www.ruby-lang.org/ja/">Ruby</a>
</ul>

<h2>履歴</h2>

<ul>
 <li> 2012/08/17 version 0.07
      <ul>
       <li> graif 1.0 対応
      </ul>
 <li> 2008/12/27 version 0.06
   <ul>
    <li> 駅名データベースの仕様変更に対応。データベースは新しいものと差
      し替えてください。
   </ul>
 <li> 2008/03/20 version 0.05
   <ul>
     <li> <a href="http://sourceforge.jp/projects/felicalib">FeliCa
	  Library</a> のドキュメントを参考に端末種、処理の種類を追加。
    <li> Suica データの読み込み、駅名データベース参照部分を大幅に書き直し。
    <li> 駅名データベースの CSV ファイル名を変更 (StationCode1.csv ->
	  StationCode0.csv など) 。
    <li> xlhtml で変換した CSV データだと正常に読み込めなかった不具合の
	  修正。
    <li> 駅名データベースを Marshal で保存し、２回め以降の起動が高速にな
	  るようにした。
    <li> 特典チャージ対応
   </ul>
 <li> 2008/03/15 version 0.4
   <ul>
     <li> 駅名データの保存が出来なくなっていた不具合の修正。
   </ul>
 <li> 2008/02/17 version 0.3
   <ul>
     <li> Felica#foreach を利用するように変更 (libpafe-ruby version
       0.0.4 以上を利用してください)。
     <li> version 0.2 で駅名などの登録が出来なくなっていた不具合の修正。
     <li> 物販の場合に記録されている時刻を無視していた不具合の修正。
   </ul>
 <li> 2008/02/03 version 0.2<br>
      version 0.2 を使用する場合、libpafe, libpafe-ruby は 0.0.3 以上の
      version を利用する必要があります。
 <li> 2008/01/14 version 0.1
</ul>

<h2>連絡先</h2>

<p>ZXB01226 at nifty.com</p>

<hr>
<p><a href="./">戻る</a></p>
</body>
</html>
